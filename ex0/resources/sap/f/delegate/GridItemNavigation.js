/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/delegate/ItemNavigation","sap/ui/events/KeyCodes","sap/base/Log","sap/f/library","sap/f/GridNavigationMatrix"],function(o,t,e,i,n,r){"use strict";const s=n.NavigationDirection;const c=10;var u=t.extend("sap.f.delegate.GridItemNavigation");u.prototype.onfocusin=function(o){t.prototype.onfocusin.call(this,o);const e=this._getGridInstance().getNavigationMatrix();if(e&&o.target===this.oDomRef){this._mCurrentPosition=this._findPositionInMatrix(e,this.getItemDomRefs().indexOf(this.iFocusedIndex))}};u.prototype.onsapfocusleave=function(o){t.prototype.onsapfocusleave.call(this,o);if(o.target===this.oDomRef){this.resetFocusPosition()}};u.prototype.onsapnext=function(o){this._moveFocus(o)};u.prototype.onsapprevious=function(o){this._moveFocus(o)};u.prototype.onsappageup=function(o){this._moveFocus(o)};u.prototype.onsappagedown=function(o){this._moveFocus(o)};u.prototype.resetFocusPosition=function(){this._mCurrentPosition=null};u.prototype.ontap=function(){this.resetFocusPosition()};u.prototype._moveFocus=function(o){const t=o.target;if(this.getItemDomRefs().indexOf(t)===-1){return}o.preventDefault();const i=this._getGridInstance().getNavigationMatrix();if(!i){return}const n=this._findPositionInMatrix(i,t);if(!this._mCurrentPosition){this._mCurrentPosition={column:n.column,row:n.row}}switch(o.keyCode){case e.ARROW_DOWN:this._moveFocusDown(n,i,t,o);break;case e.ARROW_RIGHT:this._moveFocusRight(n,i,t,o);break;case e.ARROW_UP:this._moveFocusUp(n,i,t,o);break;case e.ARROW_LEFT:this._moveFocusLeft(n,i,t,o);break;case e.PAGE_DOWN:this._moveFocusDown(n,i,t,o,c);break;case e.PAGE_UP:this._moveFocusUp(n,i,t,o,c);break;default:break}};u.prototype._moveFocusDown=function(o,t,e,n,s=1){const c={row:o.row,column:this._mCurrentPosition.column};const u={...c};let a=t[u.row][u.column];while(c.row<t.length-1&&(a===e||c.row-o.row<s)){c.row+=1;if(t[c.row][c.column]!==r.EMPTY_CELL){a=t[c.row][c.column];u.row=c.row}}if(a===e){this._onBorderReached(n);return}this._mCurrentPosition=u;this.focusItem(this.getItemDomRefs().indexOf(a),n);i.info("Grid matrix position: ("+this._mCurrentPosition.row+", "+this._mCurrentPosition.column+")")};u.prototype._moveFocusRight=function(o,t,e,n){o.row=this._mCurrentPosition.row;let s=t[o.row][o.column];while(o.column<t[o.row].length-1&&s===e){o.column+=1;if(t[o.row][o.column]!==r.EMPTY_CELL){s=t[o.row][o.column]}}if(s===e){this._onBorderReached(n);return}this._mCurrentPosition=o;this.focusItem(this.getItemDomRefs().indexOf(s),n);i.info("Grid matrix position: ("+this._mCurrentPosition.row+", "+this._mCurrentPosition.column+")")};u.prototype._moveFocusUp=function(o,t,e,n,s=1){const c={row:o.row,column:this._mCurrentPosition.column};const u={...c};let a=t[u.row][u.column];while(c.row>0&&(a===e||o.row-c.row<s)){c.row-=1;if(t[c.row][c.column]!==r.EMPTY_CELL){a=t[c.row][c.column];u.row=c.row}}if(a===e){this._onBorderReached(n);return}while(u.row>0&&t[u.row-1][u.column]===a){u.row-=1}this._mCurrentPosition=u;this.focusItem(this.getItemDomRefs().indexOf(a),n);i.info("Grid matrix position: ("+this._mCurrentPosition.row+", "+this._mCurrentPosition.column+")")};u.prototype._moveFocusLeft=function(o,t,e,n){o.row=this._mCurrentPosition.row;let s=t[o.row][o.column];while(o.column>0&&s===e){o.column-=1;if(t[o.row][o.column]!==r.EMPTY_CELL){s=t[o.row][o.column]}}if(s===e){this._onBorderReached(n);return}while(o.column>0&&t[o.row][o.column-1]===s){o.column-=1}this._mCurrentPosition=o;this.focusItem(this.getItemDomRefs().indexOf(s),n);i.info("Grid matrix position: ("+this._mCurrentPosition.row+", "+this._mCurrentPosition.column+")")};u.prototype._findPositionInMatrix=function(o,t){let e=null;o.some(function(o,i){const n=o.indexOf(t);if(n!==-1){e={};e.row=i;e.column=n;return true}return false});return e};u.prototype._onBorderReached=function(o){let t;switch(o.keyCode){case e.ARROW_RIGHT:t=s.Right;break;case e.ARROW_LEFT:t=s.Left;break;case e.ARROW_DOWN:case e.PAGE_DOWN:t=s.Down;break;case e.ARROW_UP:case e.PAGE_UP:t=s.Up;break}this._getGridInstance().onItemNavigationBorderReached({event:o,row:this._mCurrentPosition.row,column:this._mCurrentPosition.column,direction:t})};u.prototype.focusItemByDirection=function(o,t,e,i){const n=o.getNavigationMatrix();let r,c,u,a;switch(t){case s.Right:u=e;a=-1;c=n[e];if(c){do{r=c[++a]}while(!r)}break;case s.Left:u=e;a=n[0].length;c=n[e];if(c){do{r=c[--a]}while(!r)}if(r){while(a>0&&n[e][a-1]===r){a--}}break;case s.Down:u=-1;a=i;while(!r&&n[++u]&&n[u][i]!==undefined){r=n[u][i]}break;case s.Up:u=n.length;a=i;while(!r&&n[--u]&&n[u][i]!==undefined){r=n[u][i]}if(r){while(u>0&&n[u-1][i]===r){u--}}break;default:break}if(!r){return}this._mCurrentPosition={column:a,row:u};r.focus()};u.prototype._getGridInstance=function(){return o.closestTo(this.oDomRef)};return u});
//# sourceMappingURL=GridItemNavigation.js.map