/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../library","sap/ui/Device","sap/ui/core/Element","../UIArea","sap/ui/thirdparty/jquery","sap/ui/core/Configuration"],function(e,t,r,n,jQuery,o){"use strict";var i=e.dnd.RelativeDropPosition;var a={},f=null,g=null,s=null,u=[],l=[],c=null,d,p,D,h,v={},m,w,C;function b(e,t){if(!e){return}if(e.addStyleClass){e.addStyleClass(t)}else{e.$().addClass(t)}}function E(e,t){if(!e){return}if(e.removeStyleClass){e.removeStyleClass(t)}else{e.$().removeClass(t)}}function y(e,t){var n=r.closestTo(e.target,true);if(!n){return}var o=jQuery.Event(null,e);o.type=t;n.getUIArea()._handleEvent(o)}function S(e){return!e.disabled&&/^(input|textarea)$/.test(e.localName)}function A(e,t){if(!e||!e.getDragGhost){return}var r=e.getDragGhost();if(!r){return}if(!p){p=jQuery('<div class="sapUiDnDGhostContainer"></div>');jQuery(document.body).append(p)}p.append(r);window.setTimeout(function(){p.empty()},0);var n=t.originalEvent;n.dataTransfer.setDragImage(r,n.offsetX,n.offsetY)}function O(e){var t={},r,n=e.originalEvent.dataTransfer,o=function(e,t){n.setData(e,t)};return{setData:function(e,r){r=""+r;t[e]=r;o(e,r)},getData:function(e){return t[e]},setTextData:function(e){e=""+e;t["text/plain"]=e;t["text"]=e;o("text/plain",e);o("text",e)},getTextData:function(){return t["text/plain"]},setComplexData:function(e,r){t[e]=r},getComplexData:function(e){return t[e]},getIndicator:function(){return d&&d[0]},setIndicatorConfig:function(e){r=e},getIndicatorConfig:function(e){return r},getDragControl:function(){return f},getDropControl:function(){return s},setDropControl:function(e){s=e},getDropInfo:function(){return l[0]||null},getDropPosition:function(){return D}}}function T(e){f=g=s=c=null;D="";C=false;u=[];l=[]}function x(){if(d){return d}d=jQuery("<div class='sapUiDnDIndicator'></div>");jQuery(sap.ui.getCore().getStaticAreaRef()).append(d);return d}function I(){if(d){d.removeAttr("style");d.hide();v={}}}function B(e,t,r,n){if(!t){return}var a=s.getDropAreaRect?s.getDropAreaRect(n):t.getBoundingClientRect(),f=e.dragSession&&e.dragSession.getIndicatorConfig(),g=window.pageYOffset,u=window.pageXOffset,l=x(),c,d={},p={top:a.top+g,bottom:a.bottom+g,left:a.left+u,right:a.right+u,width:a.width,height:a.height};if(!r||r=="On"){c=i.On;n=""}else if(n=="Horizontal"){var D=e.pageX-p.left;d.height=p.height;d.top=p.top;if(r=="Between"){d.width="";if(D<p.width*.5){c=i.Before;d.left=p.left}else{c=i.After;d.left=p.right}}else if(r=="OnOrBetween"){if(D<p.width*.25){c=i.Before;d.left=p.left;d.width=""}else if(D>p.width*.75){c=i.After;d.left=p.right;d.width=""}else{c=i.On}}if(c!=i.On&&o.getRTL()){c=c==i.After?i.Before:i.After}}else{var h=e.pageY-p.top;d.width=p.width;d.left=p.left;if(r=="Between"){d.height="";if(h<p.height*.5){c=i.Before;d.top=p.top}else{c=i.After;d.top=p.bottom}}else if(r=="OnOrBetween"){if(h<p.height*.25){c=i.Before;d.top=p.top;d.height=""}else if(h>p.height*.75){c=i.After;d.top=p.bottom;d.height=""}else{c=i.On}}}if(f&&f.display=="none"){return c}if(c==i.On){d.top=p.top;d.left=p.left;d.width=p.width;d.height=p.height;r=c}else{r="Between"}if(v.top!=d.top||v.left!=d.left||v.width!=d.width||v.height!=d.height){l.attr("data-drop-layout",n);l.attr("data-drop-position",r);l.css(Object.assign(d,f));l.show();v=d}return c}function R(e){var t=e.getParent(),r=e.getDragDropConfig?e.getDragDropConfig():[],n=t&&t.getDragDropConfig?t.getDragDropConfig():[];return r.concat(n)}function N(e){var t=R(e);return t.filter(function(t){return t.isDraggable(e)})}function U(e,t,r){var n=R(e);t=t||[];return n.filter(function(e){return!e.isA("sap.ui.core.dnd.IDragInfo")}).concat(t).filter(function(n){if(!n.isDroppable(e,r)){return false}var o=n.getGroupName();if(!o){return true}return t.some(function(e){return e.getGroupName()==o})})}function k(e,t){e.preventDefault();if(f){var r=t.getDropEffect().toLowerCase();e.originalEvent.dataTransfer.dropEffect=r}}function P(e,t,r){var n=t.getTargetAggregation();if(!n){return B(e,r.getDomRef())}var o;if(e.getMark("DragWithin")==n){o=r.getDomRefForSetting(n)}o=o||r.getDomRef();return B(e,o,t.getDropPosition(true),t.getDropLayout(true))}a.preprocessEvent=function(e){if(c&&e.type.indexOf("dr")==0){e.dragSession=c}var t="onbefore"+e.type;if(a[t]){a[t](e)}};a.postprocessEvent=function(e){var t="onafter"+e.type;if(a[t]){a[t](e)}};a.onbeforemousedown=function(e){if(t.browser.firefox&&S(e.target)){m=jQuery(e.target).closest("[data-sap-ui-draggable=true]").prop("draggable",false)[0]}};a.onbeforemouseup=function(e){if(m){m.draggable=true;m=null}};a.onbeforedragstart=function(e){if(!e.target.draggable){return}if(S(document.activeElement)){e.target.getAttribute("data-sap-ui-draggable")&&e.preventDefault();return}f=r.closestTo(e.target,true);if(!f){return}u=N(f);if(!u.length){return}if(!t.system.desktop&&!e.originalEvent.dataTransfer.getData("text")){e.originalEvent.dataTransfer.setData("text"," ")}e.dragSession=c=O(e)};a.onafterdragstart=function(e){if(!u.length||e.isDefaultPrevented()){T();return}u=e.isMarked("NonDraggable")?[]:u.filter(function(t){return t.fireDragStart(e)});if(!u.length){e.preventDefault();T();return}A(f,e);b(f,"sapUiDnDDragging");if(jQuery(e.target).closest(".sapUiScrollDelegate")[0]){jQuery("html").addClass("sapUiDnDNoScrolling")}};a.onbeforedragenter=function(e){var t=r.closestTo(e.target,true);if(t&&g===t){e.setMark("DragWithin","SameControl")}else{h=Date.now();g=t}var n=[],o;s=t;for(var i=0;i<20&&s;i++){n=U(s,u,e);if(n.length){break}o=s.getDomRef();o=o&&o.parentElement;s=r.closestTo(o,true)}if(e.getMark("DragWithin")!="SameControl"){l=n;if(c){c.setIndicatorConfig(null)}}if(!l.length){s=null}else if(!c){C=true;e.dragSession=c=O(e)}};a.onafterdragenter=function(e){if(!s||e.isMarked("NonDroppable")){l=[]}else if(e.getMark("DragWithin")!="SameControl"){l=l.filter(function(t){return t.fireDragEnter(e)})}var t=l[0];if(!t||t.getDropEffect()=="None"){I();D=""}else{k(e,t);D=P(e,t,s)}};a.onbeforedragover=function(e){var t=Date.now();if(t-h>=1e3){y(e,"longdragover");h=t}};a.onafterdragover=function(e){var t=l[0];if(!t||t.getDropEffect()=="None"){return}l.forEach(function(t){t.fireDragOver(e)});k(e,t);if(t&&t.getDropPosition(true)=="On"){return}D=P(e,t,s)};a.onafterdragleave=function(e){if(C&&!e.relatedTarget){I();T()}};a.onbeforedrop=function(e){if(l.length){e.preventDefault()}};a.onafterdrop=function(e){l.forEach(function(t){t.fireDrop(e)});w=requestAnimationFrame(this.onafterdragend.bind(this,e))};a.onafterdragend=function(e){w=cancelAnimationFrame(w);u.forEach(function(t){t.fireDragEnd(e)});E(f,"sapUiDnDDragging");jQuery("html").removeClass("sapUiDnDNoScrolling");I();T()};n.addEventPreprocessor(a.preprocessEvent);n.addEventPostprocessor(a.postprocessEvent);return a},true);
//# sourceMappingURL=DragAndDrop.js.map