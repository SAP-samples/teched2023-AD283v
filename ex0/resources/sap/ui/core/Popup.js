/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/base/Event","sap/ui/base/ManagedObject","sap/ui/base/Object","sap/ui/base/ObjectPool","./Control","./Element","./EventBus","./FocusHandler","./IntervalTrigger","./RenderManager","./ResizeHandler","./library","./StaticArea","sap/base/assert","sap/base/Log","sap/base/i18n/Localization","sap/base/util/Version","sap/base/util/uid","sap/base/util/extend","sap/base/util/each","sap/base/util/deepExtend","sap/ui/events/F6Navigation","sap/ui/events/isMouseEventDelayed","sap/ui/base/EventProvider","sap/ui/thirdparty/jquery","sap/ui/thirdparty/jqueryui/jquery-ui-position","sap/ui/dom/jquery/control","sap/ui/dom/jquery/Focusable","sap/ui/dom/jquery/rect"],function(t,e,i,o,s,n,r,a,l,u,f,h,p,c,d,_,m,b,g,v,y,C,E,S,P,jQuery){"use strict";var O=p.CSSSize;var I=p.OpenState;var L=p.Collision;var w;var x;var F;var k="sapUiPopupResize";var A=new a;if(window.ResizeObserver){F=new window.ResizeObserver(function(t){B(jQuery("#sap-ui-blocklayer-popup"),t[0].target)})}else{F={observe:function(t){var e=t.dataset[k];if(!e){e=h.register(t,function(t){B(jQuery("#sap-ui-blocklayer-popup"),t.target)});t.dataset[k]=e}},unobserve:function(t){var e=t.dataset[k];if(e){h.deregister(e);delete t.dataset[k]}}}}function R(){if(w){return w}var t;try{w=c.getUIArea()}catch(t){_.error(t);throw new Error("Popup cannot be opened because static UIArea cannot be determined.")}t=new n;w.addDependent(t);w=t.getUIArea();t.destroy();return w}function D(t){var e;if(typeof t==="string"){e=document.querySelector(t)}else if(t instanceof r){e=t.getDomRef()}else{e=t}return e||window}function T(t){var e=["left","top","width","height"];if(t[0]){t[0].classList.remove("sapUiBLyWithin");e.forEach(function(e){t[0].style.removeProperty(e)})}}function B(t,e){var i=e.getBoundingClientRect();t.css({width:i.width,height:i.height}).addClass("sapUiBLyWithin").position({my:"left top",at:"left top",of:e})}var N=i.extend("sap.ui.core.Popup",{constructor:function(t,e,o,s){d(arguments.length==0||t&&typeof t==="object","oContent must be an object or there may be no arguments at all");d(e===undefined||e===true||e===false,"bModal must be true, false, or undefined");d(o===undefined||o===true||o===false,"bShadow must be true, false, or undefined");d(s===undefined||s===true||s===false,"bAutoClose must be true, false, or undefined");i.apply(this);this._popupUID=g();this.bOpen=false;this.eOpenState=I.CLOSED;this._mEvents={};this._mEvents["sap.ui.core.Popup.addFocusableContent-"+this._popupUID]=this._addFocusableArea;this._mEvents["sap.ui.core.Popup.removeFocusableContent-"+this._popupUID]=this._removeFocusableArea;this._mEvents["sap.ui.core.Popup.closePopup-"+this._popupUID]=this._closePopup;this._mEvents["sap.ui.core.Popup.onFocusEvent-"+this._popupUID]=this.onFocusEvent;this._mEvents["sap.ui.core.Popup.increaseZIndex-"+this._popupUID]=this._increaseMyZIndex;this._mEvents["sap.ui.core.Popup.contains-"+this._popupUID]=this._containsEventBusWrapper;this._mEvents["sap.ui.core.Popup.extendFocusInfo-"+this._popupUID]=this._extendFocusInfoEventBusWrapper;if(t){this.setContent(t)}this._oDefaultPosition={my:N.Dock.CenterCenter,at:N.Dock.CenterCenter,of:document,offset:"0 0",collision:"flip"};this._oPosition=Object.assign({},this._oDefaultPosition);this._bModal=!!e;this._oPreviousFocus=null;this._sInitialFocusId=null;this._bShadow=typeof o==="boolean"?o:true;this._bAutoClose=!!s;this._animations={open:null,close:null};this._durations={open:"fast",close:"fast"};this._iZIndex=-1;this.setNavigationMode();if(this.touchEnabled){this._fAutoCloseHandler=function(t){if(t.isMarked("delayedMouseEvent")||t.isMarked("cancelAutoClose")){return}if(this.eOpenState===I.CLOSING||this.eOpenState===I.CLOSED){return}if(!this._contains(t.target)){this.close()}}.bind(this)}this._F6NavigationHandler=function(t){var e={},i=this._sF6NavMode,o;if(i=="DOCK"){if(this._bModal){i="NONE"}else if(this._oLastPosition&&this._oLastPosition.of){o=this._getOfDom(this._oLastPosition.of);if(!o||o===document){o=null;i="NONE"}}}switch(i){case"SCOPE":e.scope=this._$()[0];break;case"DOCK":e.target=o;var s=jQuery(o).parents("[data-sap-ui-popup]");e.scope=s.length?s[0]:null;break;default:e.skip=true}E.handleF6GroupNavigation(t,e)}.bind(this)},metadata:{library:"sap.ui.core",publicMethods:["open","close","setContent","getContent","setPosition","setShadow","setModal","getModal","setAutoClose","setAutoCloseAreas","setExtraContent","isOpen","getAutoClose","getOpenState","setAnimations","setDurations","attachOpened","attachClosed","detachOpened","detachClosed"],associations:{childPopups:{type:"sap.ui.core.Popup",multiple:true,visibility:"hidden"}},events:{opened:{},closed:{}}}});N.prototype.getChildPopups=function(){return this.getAssociation("childPopups",[])};N.prototype.addChildPopup=function(t){return this.addAssociation("childPopups",t)};N.prototype.removeChildPopup=function(t){return this.removeAssociation("childPopups",t)};N.blStack=[];N.Dock={BeginTop:"begin top",BeginCenter:"begin center",BeginBottom:"begin bottom",LeftTop:"left top",LeftCenter:"left center",LeftBottom:"left bottom",CenterTop:"center top",CenterCenter:"center center",CenterBottom:"center bottom",RightTop:"right top",RightCenter:"right center",RightBottom:"right bottom",EndTop:"end top",EndCenter:"end center",EndBottom:"end bottom"};N.prototype.touchEnabled=t.support.touch&&(t.browser.safari||!t.system.combi);N.prototype.preventBrowserFocus=t.support.touch&&!t.system.combi;var U=o.extend("sap.ui.core.Popup.Layer",{constructor:function(){var t=this.getDomString();this._$Ref=jQuery(t).appendTo(c.getDomRef())}});U.prototype.init=function(t,e){this._$Ref.css({visibility:"visible","z-index":e});this.update(t,e);this._$Ref.insertAfter(t).show()};U.prototype.update=function(t,e){if(t.length){var i=t.rect();this._$Ref.css({left:i.left,top:i.top});if(t.css("right")!="auto"&&t.css("right")!="inherit"){this._$Ref.css({right:t.css("right"),width:"auto"})}else{this._$Ref.css({width:i.width,right:"auto"})}if(t.css("bottom")!="auto"&&t.css("bottom")!="inherit"){this._$Ref.css({bottom:t.css("bottom"),height:"auto"})}else{this._$Ref.css({height:i.height,bottom:"auto"})}if(typeof e==="number"){this._$Ref.css("z-index",e)}}};U.prototype.reset=function(){if(this._$Ref.length){this._$Ref[0].style.display="none";this._$Ref[0].style.visibility="hidden";this._$Ref.appendTo(c.getDomRef())}};U.prototype.getDomString=function(){_.error("sap.ui.core.Popup.Layer: getDomString function must be overwritten!");return""};var M=U.extend("sap.ui.core.Popup.ShieldLayer",{constructor:function(){U.apply(this)}});M.prototype.getDomString=function(){return'<div class="sapUiPopupShield" id="sap-ui-shieldlayer-'+g()+'"></div>'};N.prototype.oShieldLayerPool=new s(M);(function(){var t=0;var e=Math.pow(2,32)-1;N.setInitialZIndex=function(i){if(i>=e){throw new Error("Z-index can't be higher than Number.MAX_SAFE_INTEGER")}t=Math.max(i,this.getLastZIndex())};N.getLastZIndex=function(){return t};N.prototype.getLastZIndex=function(){return N.getLastZIndex()};N.getNextZIndex=function(){t+=10;if(t>=e){throw new Error("Z-index can't be higher than Number.MAX_SAFE_INTEGER")}return t};N.prototype.getNextZIndex=function(){return N.getNextZIndex()}})();var $=function(t,e){if(!t&&e||t&&!e){return false}if(!t&&!e){return true}var i=3;var o=Math.abs(t.left-e.left);var s=Math.abs(t.top-e.top);var n=Math.abs(t.width-e.width);var r=Math.abs(t.height-e.height);if(o>i||s>i||n>i||r>i){return false}return true};N.prototype.open=function(t,e,i,o,s,a,l,u){d(this.oContent,"Popup content must have been set by now");if(this.eOpenState!=I.CLOSED){return}if(typeof t=="string"){u=l;l=a;a=s;s=o;o=i;i=e;e=t;t=-1}if(typeof l==="boolean"||typeof l==="function"||l===N.CLOSE_ON_SCROLL){u=l;l=undefined}if(t===undefined){t=-1}d(t===-1||typeof t==="number"&&t%1==0,"iDuration must be an integer (or omitted)");d(e===undefined||typeof e==="string","my must be a string or empty");d(i===undefined||typeof i==="string","at must be a string or empty");d(!o||typeof o==="object"||typeof o==="function","of must be empty or an object");d(!s||typeof s==="string","offset must be empty or a string");d(!a||L.isValid(a),"collision must be empty or of type sap.ui.core.Collision");d(!l||l===window||typeof l==="string"||l instanceof r||l instanceof HTMLElement,"within must be either empty, or the global window object, or a string, or a sap.ui.core.Element, or a DOM element");d(!u||typeof u==="boolean"||typeof u==="function"||u===N.CLOSE_ON_SCROLL,"followOf must be either empty or a boolean");this.eOpenState=I.OPENING;var f=R(),h;this._bContentAddedToStatic=false;this._bUIAreaPatched=false;if(this.oContent instanceof n){if(!this.oContent.getParent()){f.addContent(this.oContent,true);this._bContentAddedToStatic=true}else if(!this.oContent.getUIArea()){this.oContent.getUIArea=function(){return f};this._bUIAreaPatched=true}h=this.oContent.getUIArea();if(N._bEnableUIAreaCheck&&h.getRootNode().id!==f.getRootNode().id){_.warning("The Popup content is NOT connected with the static-UIArea and may not work properly!")}}this._oPreviousFocus=N.getCurrentFocusInfo();if(this.isInPopup(o)||this.isInPopup(this._oPosition.of)){var p=this.getParentPopupId(o)||this.getParentPopupId(this._oPosition.of);var m="";var b=this.getContent();if(b instanceof r){m=b.getId()}else if(typeof b==="object"){m=b.id}this.addChildToPopup(p,m);this.addChildToPopup(p,this._popupUID)}var g=this._$(true);var v="fast";if(t===0||t>0){v=t}else if(this._durations.open===0||this._durations.open>0){v=this._durations.open}var y;if(e||i||o||s||a||l){y=this._createPosition(e,i,o,s,a,l);this._oPosition=y}else{y=this._oPosition;if(!this._bOwnWithin&&x){this._oPosition.within=x}}if(!y.of){y.of=this._oPosition.of||document}this._iZIndex=this._iZIndex===this.getLastZIndex()?this._iZIndex:this.getNextZIndex();var C=c.getDomRef();g.css({position:"absolute",visibility:"hidden"});if(!(g[0].parentNode==C)){g.appendTo(C)}g.css("z-index",this._iZIndex);_.debug("position popup content "+g.attr("id")+" at "+JSON.stringify(y.at));this._applyPosition(y);if(u!==undefined){this.setFollowOf(u)}g.toggleClass("sapUiShd",this._bShadow);var E=g[0];if(E){E.style.display="none";E.style.visibility="visible"}var S=v==0;this._duringOpen(!S);if(S){this._opened()}else if(this._animations.open){this._animations.open.call(null,g,v,this._opened.bind(this))}else{g.fadeIn(v,this._opened.bind(this))}};N.prototype._getDomRefToFocus=function(){var t=this._$(false,true),e,i;if(this._shouldGetFocusAfterOpen()){if(this._sInitialFocusId){i=r.getElementById(this._sInitialFocusId);if(i){e=i.getFocusDomRef()}e=e||window.document.getElementById(this._sInitialFocusId)}e=e||t.firstFocusableDomRef()}return e};N.prototype._opened=function(){if(this.eOpenState!==I.OPENING){return}this.bOpen=true;var t=this._$(false,true);if(t[0]&&t[0].style){t[0].style.display="block"}if(this._shouldGetFocusAfterOpen()){var e=this._getDomRefToFocus();if(e){e.focus()}var i=this._getOfDom(this._oLastPosition.of);var o=jQuery(i).rect();if(this._oLastOfRect&&o&&!$(this._oLastOfRect,o)){this._applyPosition(this._oLastPosition)}}this.eOpenState=I.OPEN;if(this.getFollowOf()){N.DockTrigger.addListener(N.checkDocking,this)}this.fireOpened()};N.prototype._duringOpen=function(t){var e=this._$(false,true),i=c.getDomRef(),o=document.getElementById(i.id+"-firstfe");N._clearSelection();this._setupUserSelection();if(S()){if(this._oTopShieldLayer){clearTimeout(this._iTopShieldRemoveTimer);this._iTopShieldRemoveTimer=null}else{this._oTopShieldLayer=this.oShieldLayerPool.borrowObject(e,this._iZIndex+1)}this._iTopShieldRemoveTimer=setTimeout(function(){this.oShieldLayerPool.returnObject(this._oTopShieldLayer);this._oTopShieldLayer=null;this._iTopShieldRemoveTimer=null}.bind(this),500)}if(this._bModal){this._showBlockLayer()}if(!this.touchEnabled&&t&&o&&this._shouldGetFocusAfterOpen()&&!this.isInPopup(document.activeElement)&&this._getDomRefToFocus()!==document.activeElement){o.focus({preventScroll:true})}if(this.oContent instanceof r){this.oContent.addDelegate(this)}this.bOpen=true;this._activateFocusHandle();this._$(false,true).on("keydown",this._F6NavigationHandler)};N.prototype._shouldGetFocusAfterOpen=function(){return this._bModal||this._bAutoClose||this._sInitialFocusId};N.prototype._contains=function(t){var e=this._$().get(0);if(!e){return false}var i=e.contains(t);var o;if(!i){o=this.getChildPopups();i=o.some(function(e){var i=e?window.document.getElementById(e):null;var o=i&&i.contains(t);if(!o){var s="sap.ui.core.Popup.contains-"+e;var n={domRef:t};A.publish("sap.ui",s,n);o=n.contains}return o})}if(!i){z.forEach(function(e){i=i||jQuery(t).closest(e).length>0})}return i};N.prototype._containsEventBusWrapper=function(t,e,i){i.contains=this._contains(i.domRef)};N.prototype.onFocusEvent=function(e){var i=jQuery.event.fix(e);if(arguments.length>1&&arguments[1]==="sap.ui.core.Popup.onFocusEvent-"+this._popupUID){i=jQuery.event.fix(arguments[2])}var o=i.type=="focus"||i.type=="activate"?"focus":"blur";var s=false;if(o=="focus"){var n=this._$().get(0);if(n){s=this._contains(i.target);_.debug("focus event on "+i.target.id+", contains: "+s);if(this._bModal&&!s){var r=N.blStack.length>0&&N.blStack[N.blStack.length-1].popup===this;if(r){if(t.system.desktop||jQuery(i.target).is(":input")){if(this.oLastBlurredElement){setTimeout(function(){if(this.oLastBlurredElement){this.oLastBlurredElement.focus()}}.bind(this),0)}else{n.focus()}}}}else if(this._bAutoClose&&s&&this._sTimeoutId){clearTimeout(this._sTimeoutId);this._sTimeoutId=null}}}else if(o=="blur"){_.debug("blur event on "+i.target.id);if(this._bModal){this.oLastBlurredElement=i.target}else if(this._bAutoClose){if(!this.touchEnabled&&!this._sTimeoutId){if(i.target===document.activeElement){return}var a=typeof this._durations.close==="string"?0:this._durations.close;this._sTimeoutId=setTimeout(function(){this.close(a,"autocloseBlur");var t=this._oLastPosition&&this._oLastPosition.of;if(t){var e=this.getParentPopupId(t);if(e){var o="sap.ui.core.Popup.onFocusEvent-"+e;A.publish("sap.ui",o,i)}}}.bind(this),a)}}}};N.prototype.setInitialFocusId=function(t){d(!t||typeof t==="string","sId must be a string or empty");this._sInitialFocusId=t};N.prototype.close=function(t){if(N._autoCloseDebug){return}if(this._sTimeoutId){clearTimeout(this._sTimeoutId);this._sTimeoutId=null}d(t===undefined||typeof t==="number"&&t%1==0,"iDuration must be empty or an integer");if(this.eOpenState==I.CLOSED||this.eOpenState==I.CLOSING){return}var e="fast";if(t===0||t>0){e=t}else if(this._durations.close===0||this._durations.close>0){e=this._durations.close}this.eOpenState=I.CLOSING;if(this.getFollowOf()){N.DockTrigger.removeListener(N.checkDocking,this)}if(this.oContent){if(this._bContentAddedToStatic){A.publish("sap.ui","__beforePopupClose",{domNode:this._$().get(0)});var i=c.getUIArea();i.removeContent(i.indexOfContent(this.oContent),true)}else if(this._bUIAreaPatched){delete this.oContent.getUIArea}}this._bContentAddedToStatic=false;this._bUIAreaPatched=false;this._sTimeoutId=null;this._deactivateFocusHandle();this._$(false,true).off("keydown",this._F6NavigationHandler);if(this.oContent instanceof r){this.oContent.removeDelegate(this)}var o=this._$();if(this._bEventBusEventsRegistered){this._unregisterEventBusEvents()}if(S()){if(this._oBottomShieldLayer){clearTimeout(this._iBottomShieldRemoveTimer);this._iBottomShieldRemoveTimer=null}else{this._oBottomShieldLayer=this.oShieldLayerPool.borrowObject(o,this._iZIndex-3)}this._iBottomShieldRemoveTimer=setTimeout(function(){this.oShieldLayerPool.returnObject(this._oBottomShieldLayer);this._oBottomShieldLayer=null;this._iBottomShieldRemoveTimer=null}.bind(this),500)}if(this.isInPopup(this._oLastPosition.of)){var s=this.getParentPopupId(this._oLastPosition.of);var n="";var a=this.getContent();if(a instanceof r){n=a.getId()}else if(typeof a==="object"){n=a.id}this.removeChildFromPopup(s,n);this.removeChildFromPopup(s,this._popupUID)}if(this._bModal&&this.preventBrowserFocus){o.one("mousedown",function(t){t.preventDefault()})}this._duringClose();if(e==0){this._closed()}else if(this._animations.close){this._animations.close.call(null,o,e,this._closed.bind(this))}else{o.fadeOut(e,this._closed.bind(this))}};N.prototype._closed=function(){var t=this._$(false,true);if(this._bModal){this._hideBlockLayer()}N._clearSelection();this._restoreUserSelection();if(t.length){var e=t.get(0);if(e){e.style.display="none";e.style.visibility="hidden";e.style.left="0px";e.style.top="0px";e.style.right=""}t=this._$(false,true);e=t.length?t[0]:null;if(e){e.style.display="none";e.style.visibility="hidden";e.style.left="0px";e.style.top="0px";e.style.right=""}}if(this._bModal){N.applyFocusInfo(this._oPreviousFocus);this._oPreviousFocus=null;this.oLastBlurredElement=null}this.bOpen=false;this.eOpenState=I.CLOSED;var i=this.getChildPopups();for(var o=0,s=i.length;o<s;o++){this.closePopup(i[o])}this.fireClosed()};N.prototype._duringClose=function(){if(this._resizeListenerId){h.deregister(this._resizeListenerId);this._resizeListenerId=null}};N.getCurrentFocusInfo=function(){var t=null;var e=r.closestTo(document.activeElement);if(e){t={sFocusId:e.getId(),oFocusInfo:e.getFocusInfo()}}else{t={sFocusId:document.activeElement.id,oFocusedElement:document.activeElement,oFocusInfo:{}}}if(t){t.popup=this}return t};N.applyFocusInfo=function(t){var e={preventScroll:true};if(t){var i=r.getElementById(t.sFocusId);if(i){i.applyFocusInfo(Object.assign(e,t.oFocusInfo))}else{var o=(t.sFocusId?window.document.getElementById(t.sFocusId):null)||t.oFocusedElement;if(o){o.focus(e)}}}};N.prototype.setContent=function(t){d(typeof t==="object","oContent must be an object");this.oContent=t;return this};N.prototype.getContent=function(){return this.oContent};N.prototype.setPosition=function(t,e,i,o,s,n){d(typeof t==="string","my must be a string");d(typeof e==="string"||typeof e==="object"&&typeof e.left==="number"&&typeof e.top==="number","my must be a string or an object with 'left' and 'top' properties");d(!i||typeof i==="object"||typeof i==="function","of must be empty or an object");d(!o||typeof o==="string","offset must be empty or a string");d(!s||L.isValid(s),"collision must be empty or of type sap.ui.core.Collision");d(!n||n===window||typeof n==="string"||n instanceof r||n instanceof HTMLElement,"within must be either empty, or the global window object, or a string, or a sap.ui.core.Element, or a DOM element");this._oPosition=this._createPosition(t,e,i,o,s,n);if(this.eOpenState!=I.CLOSED){this._applyPosition(this._oPosition)}return this};N.prototype._createPosition=function(t,e,i,o,s,n){var r=false;if(t&&(t.indexOf("+")>=0||t.indexOf("-")>=0)){r=true;if(o&&o!="0 0"){_.warning("offset used in my and in offset, the offset value will be ignored","sap.ui.core.Popup","setPosition")}o=null}var a=v({},this._oDefaultPosition,{my:t||this._oDefaultPosition.my,at:e||this._oDefaultPosition.at,of:i,offset:o,collision:s});if(n||x){a.within=n||x}this._bOwnWithin=!!n;if(!jQuery.ui.version){if(N._bNewOffset==null){N._bNewOffset=true;var l=jQuery(document.createElement("div"));l.position({of:window,using:function(t,e){N._bNewOffset=e!==undefined}})}}var u=[];var f=[];if(N._bNewOffset||b(jQuery.ui.version).compareTo("1.8.23")>0){if(o&&o!="0 0"){u=a.my.split(" ");f=o.split(" ");var h=[parseInt(f[0])<0?"":"+",parseInt(f[1])<0?"":"+"];a.my=u[0]+h[0]+f[0]+" "+u[1]+h[1]+f[1];a.offset=null}}else if(r){u=a.my.split(" ");f=["",""];var p=u[0].indexOf("+");if(p<0){p=u[0].indexOf("-")}if(p>=0){f[0]=u[0].slice(p);u[0]=u[0].slice(0,p)}p=u[1].indexOf("+");if(p<0){p=u[1].indexOf("-")}if(p>=0){f[1]=u[1].slice(p);u[1]=u[1].slice(0,p)}a.my=u[0]+" "+u[1];a.offset=f[0]+" "+f[1]}return a};N.prototype._getPositionOffset=function(){var t=[];if(this._oPosition.my&&(this._oPosition.my.indexOf("+")>=0||this._oPosition.my.indexOf("-")>=0)){var e=this._oPosition.my.split(" ");var i=e[0].indexOf("+");if(i<0){i=e[0].indexOf("-")}if(i>=0){t[0]=e[0].slice(i)}i=e[1].indexOf("+");if(i<0){i=e[1].indexOf("-")}if(i>=0){t[1]=e[1].slice(i)}}else if(this._oPosition.offset){t=this._oPosition.offset.split(" ")}return t};N.prototype._applyPosition=function(t){var e=m.getRTL();var i=this._$();if(i.length){var o=t.at;var s=i.get(0);if(typeof o==="string"){s.style.display="block";s.style.left="";s.style.right="";i.position(this._resolveReference(this._convertPositionRTL(t,e)));this._fixPositioning(t,e)}else if(O.isValid(o.left)&&O.isValid(o.top)){i.css({left:o.left,top:o.top})}else if(O.isValid(o.right)&&O.isValid(o.top)){i.css({right:o.right,top:o.top})}else if(typeof o.left==="number"&&typeof o.top==="number"){var n=i[0];if(n&&n.style.right){var r=i[0].getBoundingClientRect().width;i.css({right:document.documentElement.clientWidth-(o.left+r)+"px",top:o.top+"px"})}else{i.css({left:o.left+"px",top:o.top+"px"})}}this._oLastPosition=t;this._oLastOfRect=this._calcOfRect(t.of)}};N.prototype._calcOfRect=function(t){var e=this._getOfDom(t);if(e){return jQuery(e).rect()}return null};N.prototype._getOfDom=function(t){if(t instanceof jQuery.Event){return null}var e;if(typeof t==="string"){e=jQuery(document.getElementById(t))}else if(t instanceof jQuery){e=t}else{e=jQuery(t instanceof r?t.getDomRef():t)}return e[0]};N.prototype._convertPositionRTL=function(t,e){var i=Object.assign({},t);if(e){var o=false;if(i.my&&(i.my.indexOf("+")>=0||i.my.indexOf("-")>=0)){o=true}if((i.offset||o)&&(i.my.indexOf("begin")>-1||i.my.indexOf("end")>-1)&&(i.at.indexOf("begin")>-1||i.at.indexOf("end")>-1)){if(o){var s=i.my.split(" ");if(s.length==2){i.my="";if(s[0]){if(s[0].indexOf("begin")>-1||s[0].indexOf("end")>-1){if(s[0].indexOf("+")>-1){s[0]=s[0].replace("+","-")}else if(s[0].indexOf("-")>-1){s[0]=s[0].replace("-","+")}}i.my=s[0]}if(s[1]){if(s[1].indexOf("begin")>-1||s[1].indexOf("end")>-1){if(s[1].indexOf("+")>-1){s[1]=s[1].replace("+","-")}else if(s[1].indexOf("-")>-1){s[1]=s[1].replace("-","+")}}if(s[0]){i.my=i.my+" "}i.my=i.my+s[1]}}}else{i.offset=this._mirrorOffset(i.offset)}}i.my=i.my.replace("begin","right").replace("end","left");i.at=i.at.replace("begin","right").replace("end","left")}else{i.my=i.my.replace("end","right").replace("begin","left");i.at=i.at.replace("end","right").replace("begin","left")}return i};N.prototype._mirrorOffset=function(t){var e=String(t).trim().split(/\s/);var i=parseInt(e[0]);return-i+" "+e[e.length-1]};N.prototype._fixPositioning=function(t,e){var i=t.my;if(typeof i==="string"){if(N._isPositionFixingNeeded(i,e)){var o=this._$();var s=jQuery(window).width()-o[0].getBoundingClientRect().width-o.offset().left;o.css({right:s+"px",left:""})}}};N._isPositionFixingNeeded=function(t,e){return e&&(t.indexOf("right")>-1||t.indexOf("begin")>-1||t.indexOf("center")>-1)||!e&&(t.indexOf("right")>-1||t.indexOf("end")>-1)};N.prototype._resolveReference=function(t){var e,i=["of","within"];i.forEach(function(i){if(t[i]instanceof r){e=e||{};e[i]=t[i].getDomRef()}});return e?Object.assign({},t,e):t};N.prototype.setShadow=function(t){d(typeof t==="boolean","bShowShadow must be boolean");this._bShadow=t;if(this.eOpenState!=I.CLOSED){this._$().toggleClass("sapUiShd",t)}return this};N.prototype.setModal=function(t,e){d(typeof t==="boolean","bModal must be boolean");d(!e||typeof e==="string","sModalCSSClass must be empty or a string");var i=this._bModal;this._bModal=t;this._sModalCSSClass=e;if(this.isOpen()){if(i!==t){N._clearSelection();if(t){this._setupUserSelection();this._showBlockLayer()}else{this._hideBlockLayer();this._restoreUserSelection()}if(this.touchEnabled&&this._bAutoClose){if(!t){jQuery(document).on("touchstart mousedown",this._fAutoCloseHandler)}else{jQuery(document).off("touchstart mousedown",this._fAutoCloseHandler)}}}}return this};N.prototype.getModal=function(){return this._bModal};N.prototype.setNavigationMode=function(t){if(t!="NONE"&&t!="DOCK"&&t!="SCOPE"){this._sF6NavMode="NONE"}this._sF6NavMode=t};N.prototype.setAutoClose=function(t){d(typeof t==="boolean","bAutoClose must be boolean");if(this.touchEnabled&&this.isOpen()&&this._bAutoClose!==t){if(!this._bModal){if(t){jQuery(document).on("touchstart mousedown",this._fAutoCloseHandler)}else{jQuery(document).off("touchstart mousedown",this._fAutoCloseHandler)}}}this._bAutoClose=t;return this};N.prototype.setExtraContent=function(t){d(Array.isArray(t),"Extra popup content must be an array which contains either sap.ui.core.Element, DOM Element or an ID");if(!this._aExtraContent){this._aExtraContent=[]}var e=function(t){return{onBeforeRendering:function(){var e=t.getDomRef();if(e&&this.isOpen()){e.removeEventListener("blur",this.fnEventHandler,true)}},onAfterRendering:function(){var e=t.getDomRef();if(e&&this.isOpen()){e.addEventListener("blur",this.fnEventHandler,true)}}}};var i,o,s,n;for(var a=0,l=t.length;a<l;a++){o=t[a];if(o instanceof r){i=o.getId()}else if(typeof o==="object"){i=o.id}else if(typeof o==="string"){i=o}if(this.getChildPopups().indexOf(i)===-1){this.addChildPopup(i);n={id:i};if(o instanceof r){s=e(o);o.addEventDelegate(s,this);n.delegate=s}this._aExtraContent.push(n)}}return this};N.prototype.setAutoCloseAreas=N.prototype.setExtraContent;N.prototype.setAnimations=function(t,e){d(t===null||typeof t==="function","fnOpen must be a function");d(e===null||typeof e==="function","fnClose must be a function");if(t&&typeof t=="function"){this._animations.open=t}if(e&&typeof e=="function"){this._animations.close=e}return this};N.prototype.setDurations=function(t,e){d(t===null||typeof t==="number"&&t%1==0,"iOpenDuration must be null or an integer");d(!e||typeof e==="number"&&e%1==0,"iOpenDuration must be undefined or an integer");if(t>0||t===0){this._durations.open=t}if(e>0||e===0){this._durations.close=e}return this};N.CLOSE_ON_SCROLL="close_Popup_if_of_is_moved";N.prototype._fnCloseOnScroll=function(t){this.close()};N.prototype.setFollowOf=function(t){N.DockTrigger.removeListener(N.checkDocking,this);var e=false;this._bFollowOf=true;this._followOfHandler=null;if(typeof t==="function"){this._followOfHandler=t;e=true}else if(typeof t==="boolean"){e=t}else if(t===N.CLOSE_ON_SCROLL){this._followOfHandler=this._fnCloseOnScroll;e=true}else{this._bFollowOf=false;if(t!==null){_.error("Trying to set an invalid type to 'followOf: "+t)}}if(e&&this._oLastPosition){this._oLastOfRect=this._calcOfRect(this._oLastPosition.of)}if(this._bFollowOf&&this.getOpenState()===I.OPEN){N.DockTrigger.addListener(N.checkDocking,this)}};N.prototype.getAutoClose=function(){return this._bAutoClose};N.prototype.getFollowOf=function(){if(this._bFollowOf){return typeof this._followOfHandler==="function"?this._followOfHandler:true}return false};N.prototype.isOpen=function(){return this.bOpen};N.prototype.getOpenState=function(){return this.eOpenState};N.prototype.destroy=function(){if(this._resizeListenerId){h.deregister(this._resizeListenerId);this._resizeListenerId=null}this.close(0);this.oContent=null;if(this._bFollowOf){this.setFollowOf(null)}if(this._bEventBusEventsRegistered){this._unregisterEventBusEvents()}if(this._iTopShieldRemoveTimer){clearTimeout(this._iTopShieldRemoveTimer);this.oShieldLayerPool.returnObject(this._oTopShieldLayer);this._oTopShieldLayer=null;this._iTopShieldRemoveTimer=null}if(this._iBottomShieldRemoveTimer){clearTimeout(this._iBottomShieldRemoveTimer);this.oShieldLayerPool.returnObject(this._oBottomShieldLayer);this._oBottomShieldLayer=null;this._iBottomShieldRemoveTimer=null}if(this._aExtraContent){var t;this._aExtraContent.forEach(function(e){if(e.delegate){t=r.closestTo(document.getElementById(e.id));if(t){t.removeEventDelegate(e.delegate)}}})}i.prototype.destroy.apply(this,arguments)};N.prototype.exit=function(){delete this._mEvents};N.prototype._addFocusEventListeners=function(){if(!this.fnEventHandler){this.fnEventHandler=this.onFocusEvent.bind(this)}var t=this._$();var e=this.getChildPopups();var i={};var o=0,s=0;if(t.length){document.addEventListener("focus",this.fnEventHandler,true);t.get(0).addEventListener("blur",this.fnEventHandler,true);for(o=0,s=e.length;o<s;o++){i=e[o]?window.document.getElementById(e[o]):null;if(i){i.addEventListener("blur",this.fnEventHandler,true)}}}};N.prototype._removeFocusEventListeners=function(){var t=this._$(false,true);if(!t.length){return}var e=this.getChildPopups();var i={};var o=0,s=0;document.removeEventListener("focus",this.fnEventHandler,true);t.get(0).removeEventListener("blur",this.fnEventHandler,true);for(o=0,s=e.length;o<s;o++){i=e[o]?window.document.getElementById(e[o]):null;if(i){i.removeEventListener("blur",this.fnEventHandler,true)}this.closePopup(e[o])}this.fnEventHandler=null};N.prototype._activateFocusHandle=function(){if(this._bModal||this._bAutoClose){this._addFocusEventListeners()}if(this.touchEnabled&&!this._bModal&&this._bAutoClose){jQuery(document).on("touchstart mousedown",this._fAutoCloseHandler)}};N.prototype._deactivateFocusHandle=function(){if(this.fnEventHandler){this._removeFocusEventListeners()}if(this.touchEnabled&&!this._bModal&&this._bAutoClose){jQuery(document).off("touchstart mousedown",this._fAutoCloseHandler)}};N.prototype._registerEventBusEvents=function(){var t=this;y(t._mEvents,function(e,i){A.subscribe("sap.ui",e,i,t)});this._bEventBusEventsRegistered=true};N.prototype._unregisterEventBusEvents=function(){var t=this;y(t._mEvents,function(e,i){A.unsubscribe("sap.ui",e,i,t)});delete this._bEventBusEventsRegistered};N.prototype._addFocusableArea=function(t,e,i){if(this.getChildPopups().indexOf(i.id)===-1){this.addChildPopup(i.id)}};N.prototype._removeFocusableArea=function(t,e,i){this.removeChildPopup(i.id)};N.prototype._closePopup=function(t,e,i){this.close(typeof this._durations.close==="string"?0:this._durations.close)};N.prototype._setIdentity=function(t){if(typeof t==="object"){t.attr("data-sap-ui-popup",this._popupUID)}else{_.warning("Incorrect DomRef-type for 'setIdentity': "+t,this);return}if(!this._bEventBusEventsRegistered){this._registerEventBusEvents()}};N.prototype._$=function(t,e){var i;if(this.oContent instanceof n){i=this.oContent.$();if(t||i.length===0&&!e){_.info("Rendering of popup content: "+this.oContent.getId());if(i.length>0){f.preserveContent(i[0],true,false)}(new f).render(this.oContent,c.getDomRef());i=this.oContent.$()}}else if(this.oContent instanceof r){i=this.oContent.$()}else{i=jQuery(this.oContent)}this._setIdentity(i);return i};function H(t){if(N._blockLayerStateProvider){N._blockLayerStateProvider.fireEvent("blockLayerStateChange",t)}}N.attachBlockLayerStateChange=function(t,e,i){if(!N._blockLayerStateProvider){N._blockLayerStateProvider=new P}N._blockLayerStateProvider.attachEvent("blockLayerStateChange",t,e,i)};N.detachBlockLayerStateChange=function(t,e){if(N._blockLayerStateProvider){N._blockLayerStateProvider.detachEvent("blockLayerStateChange",t,e)}};function j(t,e){if(e===window){T(t);document.documentElement.classList.add("sapUiBLyBack")}else{B(t,e);e.classList.add("sapUiBLyBack");F.observe(e)}}function Z(t){if(t===window){document.documentElement.classList.remove("sapUiBLyBack")}else{t.classList.remove("sapUiBLyBack");F.unobserve(t)}}N.prototype._extendFocusInfo=function(t,i){var o=false,s="sap.ui.core.Popup.extendFocusInfo-",n;if(t instanceof e){n={info:i.info,element:t.getParameter("domRef")}}else{n=t}var a=this.getContent();var l=a instanceof r?a.getDomRef():a;if(l&&l.contains(n.element)){n.info.preventScroll=true;o=true}else{var u=this.getChildPopups();o=u.some(function(t){var e=s+t;A.publish("sap.ui",e,n);return n.extended})}return o};N.prototype._extendFocusInfoEventBusWrapper=function(t,e,i){i.contains=this._extendFocusInfo(i)};N.prototype._showBlockLayer=function(){var t=jQuery("#sap-ui-blocklayer-popup"),e="sapUiBLy"+(this._sModalCSSClass?" "+this._sModalCSSClass:""),i;if(t.length===0){t=jQuery('<div id="sap-ui-blocklayer-popup" tabindex="0" class="'+e+'"></div>');t.appendTo(c.getDomRef())}else{t.removeClass().addClass(e)}var o=N.blStack[N.blStack.length-1];if(o){i=D(o.popup._oLastPosition.within);Z(i)}i=D(this._oLastPosition.within);j(t,i);N.blStack.push({zIndex:this._iZIndex-2,popup:this});t.css({"z-index":this._iZIndex-2,visibility:"visible"}).show();if(!this.isInPopup(this._oLastPosition.of)){this._bFocusExtenderAdded=true;l.addFocusInfoExtender(this._extendFocusInfo,this)}if(N.blStack.length===1){H({visible:true,zIndex:N.blStack[0].zIndex})}};N.prototype._hideBlockLayer=function(){var t=jQuery("#sap-ui-blocklayer-popup"),e=t[0],i=this,o,s;s=D(this._oLastPosition.within);Z(s);if(t.length){if(this._bFocusExtenderAdded){this._bFocusExtenderAdded=false;l.removeFocusInfoExtender(this._extendFocusInfo,this)}if(N.blStack.length>1){N.blStack=N.blStack.filter(function(t){return t.popup!==i});o=N.blStack[N.blStack.length-1];e.style.zIndex=o.zIndex;e.style.visibility="visible";e.style.display="block";s=D(o.popup._oLastPosition.within);j(t,s)}else{o=N.blStack.pop();e.style.visibility="hidden";e.style.display="none";H({visible:false,zIndex:o.zIndex})}}};N.prototype._isFocusInsidePopup=function(){var t=this._$(false).get(0);if(t&&t.contains(document.activeElement)){return true}return false};N.DockTrigger=u;N.checkDocking=function(){if(this.getOpenState()===I.OPEN){var t=this._getOfDom(this._oLastPosition.of),e;if(t){if(t===window||t===window.document||document.documentElement.contains(t)){e=jQuery(t).rect()}else if(t.id){var i=window.document.getElementById(t.id);var o=jQuery(i).rect();if(o&&!$(e,o)){e=o;this._oLastPosition.of=i}}}if(!e){this.close();return}else if(e.left===0&&e.top===0&&e.height===0&&e.height===0&&this._oLastPosition.of.id){this._oLastPosition.of=window.document.getElementById(this._oLastPosition.of.id);t=this._getOfDom(this._oLastPosition.of);e=jQuery(t).rect();if(!e){this.close();return}}if(this._oLastOfRect){if(!$(this._oLastOfRect,e)){if(this._followOfHandler){var s=C({},this._oLastPosition),n=C({},this._oLastOfRect);this._followOfHandler({lastPosition:s,lastOfRect:n,currentOfRect:e})}else{this._applyPosition(this._oLastPosition)}}}}};N.prototype.ontouchstart=function(t){this.onmousedown(t,true);this._bMousedownCalled=true};N.prototype.onmousedown=function(t,e){if(this._bMousedownCalled&&!e){this._bMousedownCalled=false;return}if(this._iZIndex===this.getLastZIndex()||this.getModal()){return}this._increaseMyZIndex("","mousedown",t)};N.prototype._increaseMyZIndex=function(t,e,i){var o=this.getParentPopup(this._oLastPosition.of);if(i&&i.type==="mousedown"||i&&i.isFromParentPopup||o.length===0){this._iZIndex=this.getNextZIndex();var s=this._$(false,true);s.css("z-index",this._iZIndex);if(i&&!i.type||i&&i.type!="mousedown"||e==="mousedown"){var n=this.getChildPopups();for(var r=0,a=n.length;r<a;r++){this.increaseZIndex(n[r],true)}}}else if(o.length>0){var l=jQuery(o.get(0)).attr("data-sap-ui-popup");this.increaseZIndex(l,false)}};N.prototype.onAfterRendering=function(){var t=this.getContent();var e=t instanceof r?t.$():jQuery(t);e.toggleClass("sapUiShd",this._bShadow);N._clearSelection();this._setupUserSelection();e.css("position","absolute");this._setIdentity(e);var i=e[0];var o=i.style.left;var s=i.style.right;var n=i.style.top;var a=i.style.bottom;if(!(o&&o!="auto"||s&&s!="auto"||n&&n!="auto"||a&&a!="auto")){_.debug("reposition popup content "+e.attr("id")+" at "+JSON.stringify(this._oLastPosition.at));this._applyPosition(this._oLastPosition)}e.show().css({visibility:"visible","z-index":this._iZIndex});if(this.isOpen()&&(this.getModal()||this.getAutoClose())){this._addFocusEventListeners()}this._$(false,true).on("keydown",this._F6NavigationHandler)};N.prototype.onBeforeRendering=function(){if(this._resizeListenerId){h.deregister(this._resizeListenerId);this._resizeListenerId=null}if(this.isOpen()&&(this.getModal()||this.getAutoClose())){this._removeFocusEventListeners()}this._$(false,true).off("keydown",this._F6NavigationHandler)};N.prototype.isInPopup=function(t){var e=this.getParentPopup(t);return e&&e.length>0};N.prototype.getParentPopup=function(t){var e=t?t:this;var i=jQuery(e instanceof r?e.getDomRef():e);return i.closest("[data-sap-ui-popup]")};N.prototype.getParentPopupId=function(t){var e=this.getParentPopup(t);return e.attr("data-sap-ui-popup")};N.prototype.addChildToPopup=function(t,e){var i="sap.ui.core.Popup.addFocusableContent-"+t;A.publish("sap.ui",i,{id:e})};N.prototype.removeChildFromPopup=function(t,e){var i="sap.ui.core.Popup.removeFocusableContent-"+t;A.publish("sap.ui",i,{id:e})};N.prototype.closePopup=function(t){var e="sap.ui.core.Popup.closePopup-"+t;A.publish("sap.ui",e)};N.prototype.increaseZIndex=function(t,e){var i="sap.ui.core.Popup.increaseZIndex-"+t;A.publish("sap.ui",i,{isFromParentPopup:e?e:false})};N.prototype.focusTabChain=function(t){var e=t.event.target,i=t.that.getMetadata().getName(),o;if(!t.$FocusablesContent||!t.$FocusablesFooter||!t.$FocusablesContent.length&&!t.$FocusablesFooter.length){return}if(e.id===t.firstFocusable){_.debug("First dummy focus element was focused","",i);if(t.$FocusablesFooter.length>0){_.debug("Last footer element will be focused","",i);o=t.$FocusablesFooter[t.$FocusablesFooter.length-1]}else{_.debug("Last content element will be focused","",i);o=t.$FocusablesContent[t.$FocusablesContent.length-1]}}else if(e.id===t.lastFocusable){_.debug("Last dummy focus element was focues","",i);if(t.$FocusablesContent.length>0){_.debug("First content element will be focused","",i);o=t.$FocusablesContent[0]}else{_.debug("First footer element will be focused","",i);o=t.$FocusablesFooter[0]}}if(o){setTimeout(function(){var t=r.getElementById(o.id);if(t instanceof n){_.debug("Focus will be handled by "+t.getMetadata().getName(),"",i)}else{_.debug("oFocusDomRef will be focused","",i)}if(t){t.focus()}else if(o){o.focus()}return t?t.getId():o.id},0)}};N.prototype._setupUserSelection=function(){var t=this._$(false,true);N._markAsUserSelectable(t,this._bModal||N.blStack.length>0);if(this._bModal){if(N.blStack.length>0){var e=N.blStack[N.blStack.length-1];var i=function(t){return t.popup.getId()};if(N.blStack.map(i).indexOf(this.getId())===-1){N._markAsNotUserSelectable(e.popup._$(false,true),true)}else if(e.popup.getId()!==this.getId()){N._markAsNotUserSelectable(t,true)}}else{N._markAsNotUserSelectable(jQuery("html"),true);N._markExternalContentAsUserSelectable(true)}}};N.prototype._restoreUserSelection=function(){var t=this._$(false,true);N._markAsNotUserSelectable(t,false);if(N.blStack.length>0){N._markAsUserSelectable(N.blStack[N.blStack.length-1].popup._$(false,true),true)}else{N._markAsUserSelectable(jQuery("html"),false);N._markExternalContentAsNotUserSelectable(false)}};N._clearSelection=function(){var t=document.getSelection();if(!t.isCollapsed){t.removeAllRanges()}};N._markAsUserSelectable=function(t,e){t.removeClass("sapUiNotUserSelectable");if(e){t.addClass("sapUiUserSelectable")}};N._markAsNotUserSelectable=function(t,e){t.removeClass("sapUiUserSelectable");if(e){t.addClass("sapUiNotUserSelectable")}};var z=new Set,G="[data-sap-ui-integration-popup-content]";z.add(G);N.addExternalContent=function(t,e){if(!Array.isArray(t)){t=[t]}t.forEach(Set.prototype.add.bind(z));if(e){N.markExternalContentAsSelectable()}};N.removeExternalContent=function(t,e){if(!Array.isArray(t)){t=[t]}if(e){N.markExternalContentAsNotSelectable()}t.forEach(function(t){if(t!==G){z.delete(t)}})};N.markExternalContentAsSelectable=function(){N._clearSelection();if(N.blStack.length>0){N._markExternalContentAsUserSelectable(true)}};N.markExternalContentAsNotSelectable=function(){N._clearSelection();if(N.blStack.length>0){N._markExternalContentAsNotUserSelectable(false)}};N._getExternalContent=function(){var t=[];if(z.size>0){z.forEach(function(e){var i=jQuery(e);if(i.length>0){t.push(i)}})}return t};N._markExternalContentAsUserSelectable=function(t){var e=N._getExternalContent();e.forEach(function(e){N._markAsUserSelectable(e,t)})};N._markExternalContentAsNotUserSelectable=function(t){var e=N._getExternalContent();e.forEach(function(e){N._markAsNotUserSelectable(e,t)})};N.setWithinArea=function(t){x=t};N.getWithinArea=function(){return x};N.getWithinAreaDomRef=function(){return D(x)};return N});
//# sourceMappingURL=Popup.js.map