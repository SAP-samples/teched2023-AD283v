/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/EventProvider","./Plugin","sap/base/util/UriParameters","sap/ui/thirdparty/jquery","sap/base/Log","sap/base/security/encodeURL","sap/ui/core/Element","sap/ui/core/Lib"],function(t,e,i,jQuery,n,o,r,s){"use strict";var a=t.extend("sap.ui.core.support.Support",{constructor:function(e){if(!l){throw Error()}t.apply(this);var n=this;this._sType=e;this._sLocalOrigin=window.location.protocol+"//"+window.location.host;var o=this._receiveEvent.bind(this);if(window.addEventListener){window.addEventListener("message",o,false)}else{window.attachEvent("onmessage",o)}switch(e){case u.APPLICATION:this._isOpen=false;this.attachEvent(p.TEAR_DOWN,function(t){n._isOpen=false;g(n._oRemoteWindow);n._oRemoteWindow=null;a.exitPlugins(n,false)});this.attachEvent(p.LIBS,function(t){var e=a.getDiagnosticLibraries(),i=[];for(var o=0;o<e.length;o++){i.push(e[o].name)}n.sendEvent(p.LIBS,i)});this.attachEvent(p.SETUP,function(t){n._isOpen=true;a.initPlugins(n,false)});this.attachEvent(p.RELOAD,function(t){g(this._oRemoteWindow);window.location.reload()}.bind(this));this.attachEvent(p.RELOAD_WITH_PARAMETER,function(t){g(this._oRemoteWindow);this._reloadWithParameter(t.getParameter("parameterName"),t.getParameter("parameterValue"))}.bind(this));break;case u.TOOL:this._oRemoteWindow=window.opener;this._sRemoteOrigin=i.fromQuery(window.location.search).get("sap-ui-xx-support-origin");jQuery(window).on("unload",function(t){n.sendEvent(p.TEAR_DOWN);a.exitPlugins(n,true)});this.attachEvent(p.LIBS,function(t){var e=t.mParameters;if(!Array.isArray(e)){e=Object.keys(e).map(function(t){return e[t]})}s._load(e).then(function(){jQuery(function(){a.initPlugins(n,true).then(function(){n.sendEvent(p.SETUP)})})})});this.sendEvent(p.LIBS);break;default:break}}});var u={APPLICATION:"APPLICATION",TOOL:"TOOL"};var p={LIBS:"sapUiSupportLibs",SETUP:"sapUiSupportSetup",TEAR_DOWN:"sapUiSupportTeardown",RELOAD:"sapUiSupportReload",RELOAD_WITH_PARAMETER:"sapUiSupportReloadWithParameter"};a.StubType=u;a.EventType=p;var f=[];a.getStub=function(t){if(d){return d}if(t!=u.APPLICATION&&t!=u.TOOL){t=u.APPLICATION}l=true;d=new a(t);l=false;return d};a.getToolPlugins=function(){var t=[];for(var i=0;i<f.length;i++){if(f[i]instanceof e&&f[i].isToolPlugin()){t.push(f[i])}}return t};a.getAppPlugins=function(){var t=[];for(var i=0;i<f.length;i++){if(f[i]instanceof e&&f[i].isAppPlugin()){t.push(f[i])}}return t};a.prototype.getType=function(){return this._sType};a.prototype.isToolStub=function(){return this._sType===a.StubType.TOOL};a.prototype.isAppStub=function(){return this._sType===a.StubType.APPLICATION};a.prototype._receiveEvent=function(t){var e=t.data;if(typeof e==="string"&&e.indexOf("SAPUI5SupportTool*")===0){e=e.substr(18)}else{return}if(t.source!=this._oRemoteWindow){return}this._oRemoteOrigin=t.origin;var i=JSON.parse(e);var n=i.eventId;var o=i.params;this.fireEvent(n,o)};a.prototype.sendEvent=function(t,e){if(!this._oRemoteWindow){return}e=e?e:{};var i={eventId:t,params:e};var n="SAPUI5SupportTool*"+JSON.stringify(i);this._oRemoteWindow.postMessage(n,this._sRemoteOrigin)};a.prototype.openSupportTool=function(){var t=sap.ui.require.toUrl("sap/ui/core/support/support.html");var e="?sap-ui-xx-noless=true&sap-ui-xx-support-origin="+o(this._sLocalOrigin);var i;if(this._sType===u.APPLICATION){var n=window.document.getElementById("sap-ui-bootstrap");if(n){var r=sap.ui.require.toUrl("");var s=n.getAttribute("src");if(typeof s==="string"&&s.indexOf(r)===0){i=s.substr(r.length)}}}if(i&&i!=="sap-ui-core.js"&&i.indexOf("/")===-1){e+="&sap-ui-xx-support-bootstrap="+o(i)}function a(t){return t.indexOf(".")==0||t.indexOf("/")==0||t.indexOf("://")<0}if(this._sType===u.APPLICATION){if(!this._isOpen){this._oRemoteWindow=c(t+e);this._sRemoteOrigin=a(t)?this._sLocalOrigin:t}else{this._oRemoteWindow.focus()}}};a.prototype.toString=function(){return"sap.ui.core.support.Support"};a.prototype._reloadWithParameter=function(t,e){var i=window.location.search,n=t+"="+e;if(i&&i!=="?"){var o=new RegExp("(?:^|\\?|&)"+t+"=[^&]+");if(i.match(o)){i=i.replace(o,n)}else{i+="&"+n}}else{i="?"+n}window.location.search=i};var l=false;var d;function c(t){return window.open(t,"sapUiSupportTool","width=800,height=700,status=no,toolbar=no,menubar=no,resizable=yes,location=no,directories=no,scrollbars=yes")}function g(t){if(!t){return}try{t.close()}catch(t){}}a.getDiagnosticLibraries=function(){var t=sap.ui.getCore().getLoadedLibraries(),e=[];for(var i in t){var n=t[i];if(n.extensions&&n.extensions["sap.ui.support"]&&n.extensions["sap.ui.support"].diagnosticPlugins){e.push(n)}}return e};a.initPlugins=function(t,i){return new Promise(function(i,n){f=[];var o=a.getDiagnosticLibraries();for(var r=0;r<o.length;r++){var s=o[r],u=s.extensions["sap.ui.support"].diagnosticPlugins;if(Array.isArray(u)){for(var p=0;p<u.length;p++){if(f.indexOf(u[p])===-1){f.push(u[p])}}}}var l=[],d=[],r;for(r=0;r<f.length;r++){if(typeof f[r]==="string"){l.push(f[r]);d.push(r)}}sap.ui.require(l,function(){var n,o,r;for(o=0;o<arguments.length;o++){r=arguments[o];n=d[o];if(t.isToolStub()&&r.prototype.isToolPlugin()){f[n]=new r(t);h(f[n])}else if(t.isAppStub()&&r.prototype.isAppPlugin()){f[n]=new r(t)}}for(n=0;n<f.length;n++){if(f[n]instanceof e){if(t.isToolStub()&&f[n].isToolPlugin()){f[n].init(t)}else if(t.isAppStub()&&f[n].isAppPlugin()){f[n].init(t)}}}i()})})};a.exitPlugins=function(t,i){for(var n=0;n<f.length;n++){if(f[n]instanceof e){if(f[n].isToolPlugin()&&t.isToolStub()&&i){f[n].exit(t,true)}else if(f[n].isAppPlugin()&&t.isAppStub()&&!i){f[n].exit(t,false)}}}};function h(t){t.$().replaceWith("<div  id='"+t.getId()+"-Panel' class='sapUiSupportPnl'>"+"<div id='"+t.getId()+"-PanelHeader' class='sapUiSupportPnlHdr'>"+"<div id='"+t.getId()+"-PanelHandle' class='sapUiSupportPnlHdrHdl sapUiSupportPnlHdrHdlClosed'>"+"</div>"+"<div class='sapUiSupportPanelTitle'>"+t.getTitle()+"</div>"+"</div>"+"<div id='"+t.getId()+"-PanelContent' class='sapUiSupportPnlCntnt sapUiSupportHidden'>"+"<div id='"+t.getId()+"' class='sapUiSupportPlugin'></div>"+"</div>"+"</div>");t.$("PanelHeader").on("click",function(){var e=t.$("PanelHandle");if(e.hasClass("sapUiSupportPnlHdrHdlClosed")){e.removeClass("sapUiSupportPnlHdrHdlClosed");t.$("PanelContent").removeClass("sapUiSupportHidden")}else{e.addClass("sapUiSupportPnlHdrHdlClosed");t.$("PanelContent").addClass("sapUiSupportHidden")}})}a.initializeSupportMode=function(t,e){if(t.indexOf("true")>-1||t.indexOf("viewinfo")>-1){a._initializeSupportInfo(e)}};a._initializeSupportInfo=function(t){var e=[],i=[],o=[],s="support:data",u="support",p="http://schemas.sap.com/sapui5/extension/sap.ui.core.support.Support.info/1",f={};var l=function(){var t="sap-ui-support.probe",e;try{localStorage.setItem(t,t);e=localStorage.getItem(t);localStorage.removeItem(t);return e===t}catch(t){return false}}();function d(){if(l){localStorage.setItem("sap-ui-support.aSupportInfosBreakpoints/"+document.location.href,JSON.stringify(i))}}function c(){if(l){localStorage.setItem("sap-ui-support.aSupportXMLModifications/"+document.location.href,JSON.stringify(o))}}if(l){var g=localStorage.getItem("sap-ui-support.aSupportInfosBreakpoints/"+document.location.href);if(g){i=JSON.parse(g)}var g=localStorage.getItem("sap-ui-support.aSupportXMLModifications/"+document.location.href);if(g){o=JSON.parse(g)}}a.info=function(t){t._idx=e.length;if(t._idx>0&&!t.context){t.context=e[e.length-1].context}if(!t.context){n.debug("Support Info does not have a context and is ignored");return t}if(t.context&&t.context.ownerDocument&&t.context.nodeType===1){var o=t._idx+"";if(!t.context.hasAttributeNS(p,"data")){t.context.setAttribute("xmlns:"+u,p)}else{o=t.context.getAttributeNS(p,"data")+","+o}t.context.setAttributeNS(p,s,o)}e.push(t);if(i.indexOf(t._idx)>-1){n.info(t);n.info("To remove this breakpoint execute:","\nsap.ui.core.support.Support.info.removeBreakpointAt("+t._idx+")");debugger}return t._idx};a.info.getAll=function(t){if(t===undefined){return e}else{return e.filter(function(e){return e.env&&e.env.caller===t})}};a.info.getInfos=function(t){if(t&&typeof t==="string"){t=t.split(",")}else{t=[]}var i=[];for(var n=0;n<t.length;n++){if(e[t[n]]){i.push(e[t[n]])}}return i};a.info.byIndex=function(t){return e[t]};a.info.getAllBreakpoints=function(){return i};a.info.hasBreakpointAt=function(t){return i.indexOf(t)>-1};a.info.addBreakpointAt=function(t){if(i.indexOf(t)>-1){return}i.push(t);d()};a.info.removeBreakpointAt=function(t){var e=i.indexOf(t);if(e>-1){i.splice(e,1);d()}};a.info.removeAllBreakpoints=function(){i=[];d()};a.info.addSupportInfo=function(t,e){if(t&&e){if(f[t]){f[t]+=","+e}else{f[t]=e}}};a.info.byId=function(t){return f[t]||null};a.info.getIds=function(t){var e=[];for(var i in f){var n=f[i];if(n&&n.indexOf(t)>-1){e.push(i)}}return e};a.info.getElements=function(t){var e=[];for(var i in f){var n=f[i];if(n&&n.indexOf(t)===0){var o=r.getElementById(i);if(o){e.push(r.getElementById(i))}}}return e};a.info.getAllXMLModifications=function(){return o};a.info.hasXMLModifications=function(){return o.length>0};a.info.addXMLModification=function(t,e,i){o.push({id:t,idx:e,change:i});c()};a.info.removeXMLModification=function(t){var e=o.indexOf(t);if(e>-1){o.splice(e,1);c()}};a.info.removeAllXMLModification=function(){o=[];c()};a.info.modifyXML=function(t,e){if(!a.info.hasXMLModifications()){return}var i=e;if(!i||!i.nodeType||!(i.nodeType==1||i.nodeType==9)){return}if(i.nodeType===9){i=i.firstChild}var n=i.querySelectorAll("*");var r=[i];for(var s=0;s<n.length;s++){r.push(n[s])}for(var s=0;s<o.length;s++){var u=o[s],p=u.change;if(u.id===t){var f=r[u.idx];if(f.nodeType===1&&p.setAttribute){var l=f.getAttribute(p.setAttribute[0]);f.setAttribute(p.setAttribute[0],p.setAttribute[1]);if(!f._modified){f._modified=[]}f._modified.push(p.setAttribute[0]);if(!f._oldValues){f._oldValues=[]}f._oldValues.push(l)}}}};a.info._breakAtProperty=function(t){return function(e){if(e.getParameter("name")===t){debugger}}};a.info._breakAtMethod=function(t){return function(){debugger;return t.apply(this,arguments)}};var h=["sap/ui/base/ManagedObject","sap/ui/core/mvc/View","sap/ui/core/XMLTemplateProcessor","sap/ui/thirdparty/datajs"];function v(t,e,i,o){t._supportInfo=a.info;e._supportInfo=a.info;i._supportInfo=a.info;if(window.datajs){window.datajs._sap={_supportInfo:a.info}}n.info("sap.ui.core.support.Support.info initialized.")}if(!t){v.apply(null,h.map(sap.ui.requireSync));return}sap.ui.require(h,v)};return a});
//# sourceMappingURL=Support.js.map