/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/util/reflection/JsControlTreeModifier","sap/base/util/uid","sap/base/Log"],function(e,t,r){"use strict";var n={};n.CHANGE_TYPE_MOVE_FIELD="moveSimpleFormField";n.CHANGE_TYPE_MOVE_GROUP="moveSimpleFormGroup";n.sTypeTitle="sap.ui.core.Title";n.sTypeMTitle="sap.m.Title";n.sTypeToolBar="sap.m.Toolbar";n.sTypeOverflowToolBar="sap.m.OverflowToolbar";n.sTypeLabel="sap.m.Label";n.sTypeSmartLabel="sap.ui.comp.smartfield.SmartLabel";n.CONTENT_AGGREGATION="content";function o(e,t,r){return r.reduce(function(r,n){return r.then(function(r){if(r!==undefined){return r}var o=e.getControlType(n);if(t.indexOf(o)===-1){return Promise.resolve().then(e.getVisible.bind(e,n)).then(function(e){return e||undefined})}else{return false}})},Promise.resolve())}function a(e,t,r,n,a,i,l){return o(t,i,r).then(function(r){if(r){var o=a.view;var i=a.appComponent;var c;return Promise.resolve().then(t.createControl.bind(t,"sap.ui.core.Title",i,o,l)).then(function(e){c=e;t.setProperty(c,"text","");return t.insertAggregation(n,"content",c,0,o)}).then(function(){var t=e.getRevertData();t.createdTitleSelector=a.modifier.getSelector(c,a.appComponent);e.setRevertData(t)})}return Promise.resolve()}).then(function(){return t.getAggregation(n,"content")})}function i(e,t,r,n){var a;var i=-1;return o(e,t,r).then(function(o){if(o){i++}for(var l=0;l<r.length;l++){var c=e.getControlType(r[l]);if(t.indexOf(c)>-1){i++;if(i===n){a=r[l];break}}}return r.indexOf(a)})}function l(e,t,r){if(t>=e.length||t===-1){return true}var o=r.getControlType(e[t]);return n.sTypeTitle===o||n.sTypeToolBar===o||n.sTypeMTitle===o||n.sTypeOverflowToolBar===o}function c(e,t,r,n){var o=0;for(o=t+1;o<r.length;++o){var a=e.getControlType(r[o]);if(n.indexOf(a)>-1){break}}return o-t}function u(e,t,r){return c(e,r,t,[n.sTypeTitle,n.sTypeMTitle,n.sTypeToolBar,n.sTypeOverflowToolBar,n.sTypeLabel,n.sTypeSmartLabel])}function p(e,t,n,o,a){if(!l(t,n,e)){r.error("Illegal argument. iIndex has to point to a Label.")}else{o=a?o+1:o;var i=0;var c=n;var p;while(c<t.length&&i<o){++i;p=u(e,t,c);c+=p}return c}}function s(e,t,r,n,o){var a=r;for(var i=0;i<o;i++){a.splice(n+i,0,e[t+i])}return a}function g(e){return e.getTitle()||e.getToolbar()}function v(e,t,r){var o=g(t.element);var a=r.modifier.getSelector(e,r.appComponent);var i={elementSelector:r.modifier.getSelector(o,r.appComponent),source:{groupIndex:t.sourceIndex},target:{groupIndex:t.targetIndex}};return{changeType:n.CHANGE_TYPE_MOVE_GROUP,targetSelector:a,movedControl:o,movedElements:[i]}}function d(e,t,r,o,a){var i=a.modifier.getSelector(e,a.appComponent);var l=t.element.getLabel();var c=a.modifier.getSelector(l,a.appComponent);var u=g(o.parent);var p=g(r.parent);var s=a.modifier.getSelector(u,a.appComponent);var v=a.modifier.getSelector(p,a.appComponent);var d={elementSelector:c,source:{groupSelector:v,fieldIndex:t.sourceIndex},target:{groupSelector:s,fieldIndex:t.targetIndex}};return{changeType:n.CHANGE_TYPE_MOVE_FIELD,targetSelector:i,target:u,source:p,movedControl:l,movedElements:[d]}}function f(e,t,r,n,o,a){return Promise.resolve().then(function(){return o.reduce(function(r,n){return r.then(e.insertAggregation.bind(e,t,"dependents",n,0,a))},Promise.resolve())}).then(function(){return n.reduce(function(n,o,i){return n.then(e.insertAggregation.bind(e,t,r.CONTENT_AGGREGATION,o,i,a))},Promise.resolve())})}n.applyChange=function(e,t,o){var l=o.modifier;var g=o.view;var v=o.appComponent;var d;var m;var T;var C=e.getContent();var y=C.movedElements[0];return Promise.resolve().then(function(){return l.getAggregation(t,n.CONTENT_AGGREGATION)}).then(function(S){var h=S.map(function(e){return l.getSelector(e,v)});var E={content:h};e.setRevertData(E);if(e.getChangeType()===n.CHANGE_TYPE_MOVE_FIELD){var I=l.bySelector(y.elementSelector||y.element,v,g);var b=S.indexOf(I);var O=u(l,S,b);d=l.bySelector(y.target.groupSelector||y.target.groupId,v,g);var P=S.indexOf(d);var x=l.bySelector(y.source.groupSelector||y.source.groupId,v,g);var _=S.indexOf(x);var G=p(l,S,P,y.target.fieldIndex,_===P&&y.source.fieldIndex<y.target.fieldIndex);var A=u(l,S,G);m=S.slice();var N=m.slice(b,b+O);var w,L,M,R;if(b<G){w=m.slice(0,b);M=m.slice(b+O,G+A);R=m.slice(G+A,m.length);m=w.concat(M.concat(N.concat(R)))}else if(b>G){L=m.slice(0,G+A);M=m.slice(G+A,b);R=m.slice(b+O,m.length);m=L.concat(N.concat(M.concat(R)))}if(b!=G){return f(l,t,n,m,S,g)}}else if(e.getChangeType()===n.CHANGE_TYPE_MOVE_GROUP){var D=[n.sTypeTitle,n.sTypeToolBar,n.sTypeMTitle,n.sTypeOverflowToolBar];var F=l.bySelector(y.elementSelector||y.element,v,g);return Promise.resolve().then(function(){if(y.target.groupIndex===0||!F){return a(e,l,S,t,o,D,C.newControlId).then(function(e){S=e})}return undefined}).then(function(){T=F?S.indexOf(F):0;return i(l,D,S,y.target.groupIndex)}).then(function(e){d=S[e];var r=c(l,e,S,D);var o=c(l,T,S,D);m=S.slice();m.splice(T,o);e=m.indexOf(d);var a=y.source.groupIndex<y.target.groupIndex?r:0;m=s(S,T,m,e+a,o);return f(l,t,n,m,S,g)})}else{r.warning("Unknown change type detected. Cannot apply to SimpleForm")}})};n.completeChangeContent=function(e,n,o){var a;var i=o.modifier;var l=o.view;var c=o.appComponent;var u=i.bySelector(n.selector,c,l);var p=n.movedElements;if(p.length>1){r.warning("Moving more than 1 Formelement is not yet supported.")}var s=p[0];s.element=sap.ui.getCore().byId(s.id);var g=Object.assign({},n.source);var f=Object.assign({},n.target);if(!f.parent){f.parent=sap.ui.getCore().byId(f.id)}if(!g.parent){g.parent=sap.ui.getCore().byId(g.id)}if(u&&s.element&&f.parent){if(n.changeType==="moveSimpleFormGroup"){a=v(u,s,o)}else if(n.changeType==="moveSimpleFormField"){a=d(u,s,g,f,o)}}else{r.error("Element not found. This may be caused by an unstable id!")}var m={targetSelector:a.targetSelector,movedElements:a.movedElements,newControlId:i.getSelector(l.createId(t()),c)};e.setContent(m);if(a.source&&a.target){e.addDependentControl(a.source,"sourceParent",o);e.addDependentControl(a.target,"targetParent",o)}if(a.movedControl){e.addDependentControl([a.movedControl],"movedElements",o)}};n.revertChange=function(e,t,r){var o=r.modifier;var a=r.appComponent;var i=r.view;var l=e.getRevertData();var c=l.content;return o.getAggregation(t,n.CONTENT_AGGREGATION).then(function(u){var p=c.map(function(e){return o.bySelector(e,a,i)});return f(o,t,n,p,u,i).then(function(){var t=l.createdTitleSelector;var n=r.modifier.bySelector(t,r.appComponent);if(n){n.destroy()}e.resetRevertData();return true})})};n.getChangeVisualizationInfo=function(t,r){var o;var a;var i;var c=t.getContent().movedElements[0];if(c.elementSelector.id){i=e.bySelector(c.elementSelector,r)}else if(t.getContent().newControlId){i=e.bySelector(t.getContent().newControlId,r)}var u=c.source.groupSelector;if(t.getChangeType()===n.CHANGE_TYPE_MOVE_FIELD){var p=e.bySelector(c.source.groupSelector,r);var s=e.bySelector(c.target.groupSelector,r);o=p?p.getParent().getId():null;a=s?s.getParent().getId():null;u={id:o}}else if(!u&&l([i],0,e)){var g=i.getParent();u={id:g.getId()}}var v=i.getParent().getId();return{affectedControls:[v],dependentControls:[u&&u.id?u:t.getContent().targetSelector],updateRequired:true,descriptionPayload:{sourceContainer:o,targetContainer:a}}};return n},true);
//# sourceMappingURL=MoveSimpleForm.js.map