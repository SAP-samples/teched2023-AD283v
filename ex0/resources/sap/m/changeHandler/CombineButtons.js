/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/uid","sap/ui/core/Configuration","sap/ui/fl/util/ManagedObjectModel"],function(e,t){"use strict";var n={};var r="$sap.m.flexibility.CombineButtonsModel";function o(e,n,o,i,a,u,c,s,l){var d="";var g="";var m="";var v=[];var f=t.getRTL();var p=[];return e.reduce(function(e,t,b){var h;var C=b;var y;var I;var P=s.buttonsIdForSave[C];var S;var B="$sap.m.flexibility.MenuButtonModel"+C;return e.then(n.getProperty.bind(n,t,"text")).then(function(e){S=e;return n.createControl("sap.m.MenuItem",o,c,P)}).then(function(e){y=e;return n.findIndexInParentAggregation(t)}).then(function(e){l.insertIndexes[C]=e;return n.createControl("sap.ui.fl.util.ManagedObjectModel",o,c,Object.assign({},P,{id:P.id+"-managedObjectModel"}),{object:t,name:r})}).then(function(e){I=e;return n.insertAggregation(y,"dependents",I,0,c)}).then(function(){return n.createControl("sap.ui.core.CustomData",o,c,Object.assign({},P,{id:P.id+"-customData"}),{key:"{ path: '"+r+">key' }",value:"{ path: '"+r+">value' }"})}).then(function(e){n.bindProperty(y,"text",r+">/text");n.bindProperty(y,"icon",r+">/icon");n.bindProperty(y,"enabled",r+">/enabled");n.bindProperty(y,"visible",r+">/visible");return n.bindAggregation(y,"customData",{path:r+">/customData",template:e,templateShareable:false},c)}).then(function(){if(S){f?p.unshift(S):p.push(S)}var e=Object.assign({},P,{id:P.id+"-originalButtonId"});return n.createControl("sap.ui.core.CustomData",o,c,e)}).then(function(e){h=e;n.setProperty(h,"key","originalButtonId");n.setProperty(h,"value",n.getId(t));return n.removeAggregation(a,u,t)}).then(function(){return n.insertAggregation(a,"dependents",t,0,c)}).then(function(){n.insertAggregation(t,"customData",h,0,c)}).then(function(){n.insertAggregation(i,"items",y,C,c)}).then(function(){return n.createControl("sap.ui.fl.util.ManagedObjectModel",o,c,Object.assign({},P,{id:P.id+"-managedObjectModelMenuItem"}),{object:y,name:B})}).then(function(e){v[C]=e;d=d+m+"${"+B+">/enabled}";g=g+m+"${"+B+">/visible}";m=" || ";return{menuButtonModels:v,menuButtonName:p,propertyEnabled:d,propertyVisible:g}})},Promise.resolve())}n.applyChange=function(e,t,r){if(r.modifier.targets!=="jsControlTree"){return Promise.reject(new Error("Combine buttons change can't be applied on XML tree"))}var i=e.getContent();var a=r.modifier;var u=r.view;var c=r.appComponent;var s;var l;var d;var g;var m;var v;var f;var p={parentAggregation:"",insertIndexes:[]};var b=[];var h=[];return Promise.resolve().then(a.bySelector.bind(a,i.combineButtonSelectors[0],c,u)).then(function(e){l=e;s=a.getParent(l);var t=[];i.combineButtonSelectors.forEach(function(e){var n=Promise.resolve().then(a.bySelector.bind(a,e,c,u));t.push(n)});return Promise.all(t)}).then(function(e){m=e;return a.getParentAggregationName(m[0],s)}).then(function(e){g=e;p.parentAggregation=g;return a.findIndexInParentAggregation(l)}).then(function(e){d=e;return a.createControl("sap.m.Menu",c,u,i.menuIdSelector)}).then(function(e){v=e;return a.attachEvent(v,"itemSelected","sap.m.changeHandler.CombineButtons.pressHandler",null,n.pressHandler)}).then(function(){return o(m,a,c,v,s,g,u,i,p)}).then(function(e){b=e.menuButtonModels;h=e.menuButtonName;var t=e.propertyVisible;var n=e.propertyEnabled;return a.createControl("sap.m.MenuButton",c,u,i.menuButtonIdSelector,{visible:"{= "+t+"}",enabled:"{= "+n+"}"})}).then(function(e){f=e;return b.reduce(function(e,t){return e.then(a.insertAggregation.bind(a,f,"dependents",t,0,u))},Promise.resolve())}).then(function(){a.setProperty(f,"text",h.join("/"));return Promise.resolve().then(a.insertAggregation.bind(a,f,"menu",v,0,u)).then(a.insertAggregation.bind(a,s,g,f,d,u)).then(function(){e.setRevertData(p)})})};function i(e,t){return e.reduce(function(e,n){return e.then(function(){return t.getProperty(n,"key")}).then(function(e){if(e==="originalButtonId"){return t.destroy(n)}return undefined})},Promise.resolve())}n.revertChange=function(e,t,n){var r=n.modifier;var o=n.view;var a=e.getRevertData();var u=e.getContent();var c=a.parentAggregation;var s,l,d;return Promise.resolve().then(function(){return r.bySelector(u.menuButtonIdSelector,n.appComponent,o)}).then(function(e){s=e;l=r.getParent(s);d=u.combineButtonSelectors.slice().reverse();return r.removeAggregation(l,c,s)}).then(function(){return r.destroy(s)}).then(function(){var t=d.length;return d.reduce(function(e,u,s){var d=s;var g;return e.then(function(){return r.bySelector(u,n.appComponent,o)}).then(function(e){g=e;return r.getAggregation(g,"customData")}).then(function(e){return i(e,r)}).then(function(){return r.insertAggregation(l,c,g,a.insertIndexes[t-d-1],o)})},Promise.resolve()).then(function(){e.resetRevertData()})})};n.completeChangeContent=function(t,n,r){var o=r.modifier;var i=r.appComponent;var a=n.combineElementIds;if(a&&a.length>1){var u={};t.addDependentControl(a,"combinedButtons",r);u.combineButtonSelectors=a.map(function(e){return o.getSelector(e,i)});u.menuButtonIdSelector=o.getSelector(i.createId(e()),i);u.menuIdSelector=o.getSelector(i.createId(e()),i);u.buttonsIdForSave=a.map(function(){return o.getSelector(i.createId(e()),i)});t.setContent(u)}else{throw new Error("Combine buttons action cannot be completed: oSpecificChangeInfo.combineElementIds attribute required")}};n.pressHandler=function(e){var t=e.getParameter("item").getModel(r).getObject();t.firePress()};return n},true);
//# sourceMappingURL=CombineButtons.js.map