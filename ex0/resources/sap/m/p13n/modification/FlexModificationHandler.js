/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ModificationHandler","sap/m/p13n/FlexUtil","sap/m/p13n/enum/PersistenceMode","sap/ui/core/Core"],function(n,e,t,i){"use strict";var r,o,a,u;var s=function(){if(!a){a=new Promise(function(n,e){sap.ui.require(["sap/ui/fl/apply/api/FlexRuntimeInfoAPI"],function(e){n(e)},e)})}return a};var f=function(){if(!u){u=new Promise(function(n,e){sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],function(e){n(e)})})}return u};var c=n.extend("sap.m.p13n.modification.FlexModificationHandler");c.prototype.processChanges=function(n,i){var r=n&&n[0]?n[0].selectorElement:undefined;var o=i.mode;var a=o===t.Auto;if(a){o=i.hasVM?"Standard":t.Global}var u=o===t.Global;var s=o===t.Transient;return this.initialize().then(function(){var t=e.handleChanges(n,u,s);return u?t.then(function(n){return e.saveChanges(r,n)}):t})};c.prototype.waitForChanges=function(n,e){return this.initialize().then(function(){return s().then(function(t){return t.waitForChanges(n,e)})})};c.prototype.hasChanges=function(n,e){var i=e.mode;if(i===t.Auto){i=e.hasVM?"Standard":t.Global}return this.initialize().then(function(){if(i===t.Global){return s().then(function(e){return e.isPersonalized({selectors:[n.selector]})})}else{return f().then(function(e){return e.hasDirtyFlexObjects(n)})}})};c.prototype.reset=function(n,i){var r=i.mode;var o=r===t.Global;var a=!i.hasVM&&i.hasPP&&r===t.Auto;return this.initialize().then(function(){return o||a?e.reset(n):e.restore(n)})};c.prototype.isModificationSupported=function(n,e){return this.initialize().then(function(){return s().then(function(t){return t.isFlexSupported(n,e)})})};c.prototype.initialize=function(){if(!o){o=i.loadLibrary("sap.ui.fl",{async:true})}return o};c.getInstance=function(){if(!r){r=new c}return r};return c});
//# sourceMappingURL=FlexModificationHandler.js.map