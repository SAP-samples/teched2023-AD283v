/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/Engine","sap/m/p13n/modules/xConfigAPI"],function(e,t){"use strict";var n={};var a=function(e,t){var n=function(t){if(e._pQueue===t){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(t):t();e._pQueue.then(n.bind(null,e._pQueue));return e._pQueue};function g(t,n){if(t.isA){e.getInstance().trace(t,{selectorElement:t,changeSpecificData:{changeType:n.getChangeType(),content:n.getContent()}});if(!t._pPendingModification){t._pPendingModification=e.getInstance().waitForChanges(t).then(function(){e.getInstance().fireStateChange(t);e.getInstance().clearTrace(t);delete t._pPendingModification})}}}n.createHandler=function(t){if(!t||!t.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!")}var n=t.property;var r;return{changeHandler:{applyChange:function(o,i,p){return a(i,function(){return e.getInstance().readXConfig(i,{propertyBag:p}).then(function(a){var g=o.getChangeType().indexOf("add")>-1?"add":"remove";g=o.getChangeType().indexOf("move")===0?"move":g;r=o.getContent().targetAggregation;var u={key:o.getContent().key};u.value=g!=="add";var c;if(g==="move"){c=e.getInstance().getController(i,o.getChangeType()).getCurrentState();var f=c.find(function(e,t){if(e.key===o.getContent().key){return e}});u.targetAggregation=o.getContent().targetAggregation;u.index=c.indexOf(f)}if(a&&a.aggregations&&a.aggregations[r]&&a.aggregations[r][o.getContent().key]&&a.aggregations[r][o.getContent().key][n]){u.value=a.aggregations[r][o.getContent().key][n]}o.setRevertData(u);var d={property:n,key:o.getContent().key,value:o.getContent(),operation:g,changeType:o.getChangeType(),propertyBag:p,markAsModified:true};if(t.aggregationBased){d.controlMeta={aggregation:r}}return e.getInstance().enhanceXConfig(i,d)}).then(function(){g(i,o)})})},completeChangeContent:function(e,t,n){},revertChange:function(a,o,i){var p=a.getChangeType().indexOf("add")>-1?"remove":"add";p=a.getChangeType().indexOf("move")===0?"move":p;r=a.getContent().targetAggregation;var u={controlMeta:{aggregation:r,property:n},property:n,operation:p,changeType:a.getChangeType(),key:a.getRevertData().key,value:a.getRevertData(),propertyBag:i};if(t.aggregationBased){u.controlMeta={aggregation:r}}return e.getInstance().enhanceXConfig(o,u).then(function(){a.resetRevertData();g(o,a)})}},layers:{USER:true}}};return n});
//# sourceMappingURL=xConfigHandler.js.map